# Code Book
The purpose of this text is to give an explanation of the process followed to generate the requested tidy data set, the information about the structures generated and key lines of code are also detailed.
 
## Objective of run_analysis.R

The purpose of this script is to merge two datasets, training and test. Each one of them is structured by a *subject_test, X_datasetName *and* Y_datasetName* where *datasetName* is *training* or *test* respectively.
The problem requested to only extract the features related to mean or standard deviation measurements, use descriptive names for each one of the activities in the data set and to appropriately label the data set variables with descriptive names. At the end of the program a table containing the average of each variable for each activity and each subject should be exported.

##  Steps and Script Explanation
**Getting the data**
Since the provided url containing the data set cointained a zip file it is stored inside the *data* folder. Using the unzip function the file is decompressed allowing us to access to the *train* and *test* data.

    download.file("https://d396qusza40orc.cloudfront.net/getdata%2Fprojectfiles%2FUCI%20HAR%20Dataset.zip", dest= "./data/dataset.zip", mode = "wb")
    
    in_file <- "./data/dataset.zip"
    outDir <- "./data"
    unzip(in_file, exdir = outDir)

The *train* and *test* data shares the *features* and *activity labels* and they are extracted at the beginning of the script. Because the files are not comma separated a `read.table` function is used.

    features <- read.table("./data/UCI HAR Dataset/features.txt")
    activity_labels <- read.table("./data/UCI HAR Dataset/activity_labels.txt")

**Extracting only the requested features**
Since the features have already been extracted in `features` the features are obtained using the `grepl` function. This is achieved by returning true whenever a feature contains either a *mean()* or *std()* substring and store the resulting logic vector in `features_mask`.
In order to get the  `features_names` the logic vector previously obtained is applied to the `features` dataframe and the second dimension is extracted. Finally the `gsub` function allows us to remove the symbols `-` and `()` from the string, and the words *mean* and *std* are standarized.

    
    features_mask <- grepl("*mean()*|*std()*", features[,2])
    features_names <- features[features_mask, 2]
    features_names <- gsub("mean","Mean",features_names)
    features_names <- gsub("std","Std",features_names)
    features_names <- gsub("[-]|[()]","",features_names)
    
**Reading the files**
Because the files are *.txt*s and are not comma separated, the function `read.table` is used.
After reading the file the logic vector `features_mask` is applied to `x_datasetName` in order to only get the specified features *-the ones related with mean and standard deviation-*. After reading the `y_datasetName` and the `subject_datasetName` the resulting tables are merged using a column bind with the `cbind` function.

    # Load and merge test data.
    x_test <- read.table("./data/UCI HAR Dataset/test/X_test.txt")[features_mask]
    y_test <- read.table("./data/UCI HAR Dataset/test/y_test.txt")
    subject_test <- read.table("./data/UCI HAR Dataset/test/subject_test.txt")
    
    test_data <- cbind(subject_test,y_test,x_test)
    rm("x_test","y_test","subject_test")
    
    # Load and merge train data.
    x_train <- read.table("./data/UCI HAR Dataset/train/X_train.txt")[features_mask]
    y_train <- read.table("./data/UCI HAR Dataset/train/y_train.txt")
    subject_train <- read.table("./data/UCI HAR Dataset/train/subject_train.txt")
    
    train_data <- cbind(subject_train, y_train, x_train)
    rm("x_train","y_train","subject_train")

**Where `datasetName` stands either for test and train since this is applied for both cases.*

**Merging Test and Train**
A new *dataframe* is generated by applying a row bind with the `rbind` function to `train_data` and `test_train`, this is done in order to keep the same structure of the data frame. The result is stored in `merged_data`.

    
    merged_data <- rbind(train_data, test_data)
    rm("test_data","train_data")

**Adding descriptive names to columns**
Since the features related have been already processed and the order of the dataframe has been stablished the column names can be assigned as in the following code.

    new_names <- c("subject","activity", features_names)
    colnames(merged_data) <- new_names

**Setting descriptive names to activities**
In order to substitute the values in `activity` the `activity_labels` dataframe is used. The object `activity_labels` contains in its first dimension the number which will be used to match the values in `activity_labels` *(levels)* and the new values that will be added in `activity` *(labels)* are stored in the second dimension.

    merged_data$activity <- factor(merged_data$activity, levels = activity_labels[,1], labels = activity_labels[,2])

**Creating the exportable table**
Since the problem stablishes that each one of the feature's average should be calculated for each `subject` and `activity` they need to be converted to `factors` in order to apply a `group_by` function from the `dplyr` package and store the result in `exported_data`. Because of this we can apply a `summarize_all` function to `exported_data` in order to calculate the mean of each feature.

    merged_data$subject <- as.factor(merged_data$subject)
    exported_data <- group_by(merged_data,subject, activity)
    exported_data <- summarize_all(exported_data, mean)

After calculating the mean we have all the necessary data and it is exported as in the following code:

    write.table(exported_data, file="FeatureAvg_ActivitySubject.txt", row.names = FALSE)

## Table of Structures
|Object|Content|
|--|--|
| features | Stores the content from 'features.txt'. |
| activity_labels| Bidimensional object containing the equivalent values for `activity`. |
| features_mask| Logical vector, where the requested features are marked as true. |
| features_names| Stores the names of the  requested features. |
| x_test | Stores the content from 'x_test.txt'. |
| y_test | Stores the content from 'y_test.txt'. |
| subject_test | Stores the content from 'subject_test.txt'. |
| x_train | Stores the content from 'x_train.txt'. |
| y_train | Stores the content from 'y_train.txt'. |
| subject_train | Stores the content from 'subject_train.txt'. |
| test_data | Stores the column binds from `x_test`, `y_test` and `subject_test`. |
| train_data | Stores the column binds from `x_train`, `y_train` and `subject_train`. |
| merged_data| Stores the binded rows from `test_data` and `train_data`. |
| exported_data| Stores the mean for each one of the features for each *subject* and *activity* .|
